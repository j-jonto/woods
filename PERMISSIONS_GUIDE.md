# دليل نظام الصلاحيات - نظام إدارة الخشب

## نظرة عامة

تم تفعيل نظام الصلاحيات والأدوار في النظام لضمان الأمان والتحكم في الوصول للمستخدمين حسب وظائفهم.

## الأدوار المتوفرة

### 1. مدير النظام (Administrator)
- **الوصف**: مدير النظام الكامل
- **الصلاحيات**: جميع الصلاحيات
- **المستخدم**: admin@example.com

### 2. محاسب (Accountant)
- **الوصف**: مسؤول عن الشؤون المالية والحسابات
- **الصلاحيات**:
  - إدارة دليل الحسابات
  - إدارة القيود اليومية
  - إدارة الخزنة العامة
  - إدارة المصروفات والإيرادات
  - إدارة حسابات الصندوق والبنك
  - إدارة مدفوعات الموردين
  - إدارة سندات القبض والصرف
  - عرض التقارير المالية
  - طباعة التقارير والإيصالات
- **المستخدم**: mohamed@example.com

### 3. مدير الإنتاج (Production Manager)
- **الوصف**: مسؤول عن الإنتاج والمخزون
- **الصلاحيات**:
  - إدارة الإنتاج وأوامر الإنتاج
  - إدارة قوائم المواد
  - إدارة مراكز العمل
  - إدارة المخزون والأصناف
  - إدارة المستودعات
  - عرض تقارير الإنتاج والمخزون
  - طباعة التقارير
- **المستخدم**: (يتم إنشاؤه حسب الحاجة)

### 4. موظف مبيعات (Sales Clerk)
- **الوصف**: مسؤول عن المبيعات والعملاء
- **الصلاحيات**:
  - إدارة العملاء
  - إدارة طلبات المبيعات
  - عرض تقارير المبيعات
  - عرض تقارير المخزون
  - طباعة الفواتير والتقارير
- **المستخدم**: fatima@example.com

### 5. موظف مخزون (Inventory Clerk)
- **الوصف**: مسؤول عن المخزون والأصناف
- **الصلاحيات**:
  - إدارة المخزون
  - إدارة الأصناف
  - إدارة المستودعات
  - عرض تقارير المخزون
  - طباعة التقارير
- **المستخدم**: (يتم إنشاؤه حسب الحاجة)

## الصلاحيات المتوفرة

### إدارة النظام
- `manage users` - إدارة المستخدمين
- `manage roles` - إدارة الأدوار
- `manage permissions` - إدارة الصلاحيات
- `view dashboard` - عرض لوحة التحكم
- `manage audit logs` - إدارة سجلات التدقيق

### إدارة الحسابات
- `manage coa` - إدارة دليل الحسابات
- `manage journal entries` - إدارة القيود اليومية
- `view financial reports` - عرض التقارير المالية
- `manage expenses` - إدارة المصروفات
- `manage revenues` - إدارة الإيرادات
- `manage treasury` - إدارة الخزنة العامة
- `manage cash accounts` - إدارة حسابات الصندوق والبنك
- `manage supplier payments` - إدارة مدفوعات الموردين
- `manage receipt vouchers` - إدارة سندات القبض
- `manage payment vouchers` - إدارة سندات الصرف

### إدارة المخزون
- `manage inventory` - إدارة المخزون
- `view inventory reports` - عرض تقارير المخزون
- `manage items` - إدارة الأصناف
- `manage warehouses` - إدارة المستودعات
- `manage item categories` - إدارة فئات الأصناف

### إدارة الإنتاج
- `manage production` - إدارة الإنتاج
- `view production reports` - عرض تقارير الإنتاج
- `manage production orders` - إدارة أوامر الإنتاج
- `manage bill of materials` - إدارة قوائم المواد
- `manage work centers` - إدارة مراكز العمل

### إدارة المشتريات
- `manage purchasing` - إدارة المشتريات
- `view purchasing reports` - عرض تقارير المشتريات
- `manage suppliers` - إدارة الموردين
- `manage purchase invoices` - إدارة فواتير الشراء

### إدارة المبيعات
- `manage sales` - إدارة المبيعات
- `view sales reports` - عرض تقارير المبيعات
- `manage customers` - إدارة العملاء
- `manage sales orders` - إدارة طلبات المبيعات

### إدارة الأصول
- `manage fixed assets` - إدارة الأصول الثابتة
- `view fixed asset reports` - عرض تقارير الأصول
- `manage asset categories` - إدارة فئات الأصول
- `manage asset depreciations` - إدارة إهلاك الأصول
- `manage asset inventories` - إدارة جرد الأصول

### الطباعة
- `print reports` - طباعة التقارير
- `print invoices` - طباعة الفواتير
- `print vouchers` - طباعة الإيصالات

## كيفية إضافة مستخدم جديد

### 1. إنشاء المستخدم
```php
$user = User::create([
    'name' => 'اسم المستخدم',
    'email' => 'user@example.com',
    'password' => Hash::make('password'),
]);
```

### 2. تعيين دور
```php
$user->assignRole('Accountant'); // أو أي دور آخر
```

### 3. تعيين صلاحيات إضافية (اختياري)
```php
$user->givePermissionTo('print reports');
```

## كيفية التحقق من الصلاحيات

### في الـ Controllers
```php
if (auth()->user()->can('manage users')) {
    // إجراء العملية
}
```

### في الـ Views (Blade)
```php
@can('manage users')
    <a href="{{ route('users.index') }}">إدارة المستخدمين</a>
@endcan

@canany(['manage inventory', 'manage items'])
    <a href="{{ route('items.index') }}">إدارة الأصناف</a>
@endcanany
```

### في المسارات
```php
Route::middleware(['auth', 'permission:manage users'])->group(function () {
    Route::resource('users', UserController::class);
});
```

## اختبار النظام

### بيانات تسجيل الدخول للاختبار:

1. **مدير النظام**:
   - البريد: admin@example.com
   - كلمة المرور: 123456
   - الصلاحيات: جميع الصلاحيات

2. **محاسب**:
   - البريد: mohamed@example.com
   - كلمة المرور: 123456
   - الصلاحيات: الصلاحيات المالية فقط

3. **موظف مبيعات**:
   - البريد: fatima@example.com
   - كلمة المرور: 123456
   - الصلاحيات: صلاحيات المبيعات فقط

## ملاحظات مهمة

1. **الأمان**: كل مستخدم يرى فقط الأقسام التي لديه صلاحية للوصول إليها
2. **التدرج**: يمكن إضافة صلاحيات إضافية لأي مستخدم حسب الحاجة
3. **المرونة**: يمكن إنشاء أدوار جديدة أو تعديل الصلاحيات الموجودة
4. **التتبع**: جميع العمليات يتم تسجيلها في سجلات التدقيق

## استكشاف الأخطاء

### إذا لم تظهر الأقسام:
- تأكد من أن المستخدم لديه الدور المناسب
- تأكد من أن الدور لديه الصلاحيات المطلوبة
- امسح الكاش: `php artisan cache:clear`

### إذا ظهرت رسالة "ليس لديك صلاحية":
- تأكد من أن المسار محمي بالصلاحية الصحيحة
- تأكد من أن المستخدم لديه الصلاحية المطلوبة

## الدعم

إذا واجهت أي مشاكل في نظام الصلاحيات، يرجى التواصل مع فريق التطوير. 